---
title: "BTC Hourly Close: Distribution & Dry/Wet Years"
author: "Nadhir Benhalima"
format:
  html:
    toc: true
execute:
  echo: false
  warning: false
  message: false
params:
  out_dir: "outputs"
---

```{r}
suppressPackageStartupMessages({
  library(tidyverse)
  library(lubridate)
  library(knitr)
})

out <- params$out_dir

required_files <- c(
  "task1_stats.csv",
  "task1_model_comparison.csv",
  "task1_plot1_hist_density_raw.png",
  "task1_plot2_ecdf_raw.png",
  "task1_plot3_qq_logQ.png",
  "task1_plot4_density_logx.png",
  "task2_selected_years.csv",
  "task2_annual_summary.csv",
  "task2_seasonal_signature.csv",
  "task2_plot1_timeseries_selected_years.png",
  "task2_plot2_cumulative_selected_years.png",
  "task2_plot3_monthly_boxplots.png",
  "task2_plot4_monthly_means.png"
)

missing <- required_files[!file.exists(file.path(out, required_files))]
if (length(missing) > 0) {
  stop(
    "Missing output files in '", out, "':\n- ",
    paste(missing, collapse = "\n- "),
    "\n\nRun: Rscript run_all.R (then render again)."
  )
}

task1_stats <- readr::read_csv(file.path(out, "task1_stats.csv"), show_col_types = FALSE)
task1_cmp   <- readr::read_csv(file.path(out, "task1_model_comparison.csv"), show_col_types = FALSE)

task2_years <- readr::read_csv(file.path(out, "task2_selected_years.csv"), show_col_types = FALSE)
task2_annual <- readr::read_csv(file.path(out, "task2_annual_summary.csv"), show_col_types = FALSE)
task2_sig   <- readr::read_csv(file.path(out, "task2_seasonal_signature.csv"), show_col_types = FALSE)

period_start <- ymd_hms(task1_stats$start[1], tz = "UTC")
period_end   <- ymd_hms(task1_stats$end[1], tz = "UTC")
```

## Introduction

This report assembles results already generated by the R pipeline in `outputs/`.

- Task 1: distribution and distribution-model comparison for BTC hourly close prices.
- Task 2: two “dry” (low average close) and two “wet” (high average close) years, plus seasonality.

## Methods & Results

### Task 1: Distribution of BTC close price

**Observational period**: `r format(period_start, "%Y-%m-%d")` to `r format(period_end, "%Y-%m-%d")`.
**Sample size**: `r task1_stats$n[1]`

#### Statistical parameters

```{r}
task1_stats %>%
  select(n, start, end, min, q25, median, mean, geom_mean, q75, max) %>%
  kable(digits = 3)
```

#### Plots (already generated)

```{r}
knitr::include_graphics(file.path(out, "task1_plot1_hist_density_raw.png"))
knitr::include_graphics(file.path(out, "task1_plot2_ecdf_raw.png"))
knitr::include_graphics(file.path(out, "task1_plot3_qq_logQ.png"))
knitr::include_graphics(file.path(out, "task1_plot4_density_logx.png"))
```

#### Compare distribution models (positive-value fits)

```{r}
task1_cmp %>%
  arrange(AIC) %>%
  kable(digits = 2)
```

#### Interpretation (write-up)

- Explain which plot best shows the distribution shape (e.g., histogram+density for central mass, ECDF/QQ for tails).
- Discuss parameters (min/max/mean/median/geom mean/quartiles) together with skewness and tail behavior.
- Compare transformations (none, log, sqrt) and justify which is most appropriate.

Optional: estimate 100-year flood via right one-sided 1% prediction interval, based on your chosen model.

### Task 2: Dry and wet years (BTC context)

#### Selected years

```{r}
task2_years %>% kable()
```

#### Annual summary

```{r}
task2_annual %>% kable(digits = 3)
```

#### Seasonal signature

```{r}
task2_sig %>% kable(digits = 3)
```

#### Plots (already generated)

```{r}
knitr::include_graphics(file.path(out, "task2_plot1_timeseries_selected_years.png"))
knitr::include_graphics(file.path(out, "task2_plot2_cumulative_selected_years.png"))
knitr::include_graphics(file.path(out, "task2_plot3_monthly_boxplots.png"))
knitr::include_graphics(file.path(out, "task2_plot4_monthly_means.png"))
```

## Discussion

Connect the statistical parameters and figures, justify the preferred transformation/model, and discuss the chosen dry/wet years and their seasonal characteristics.

Include 2–3 literature references (author–year style).

## References

- Add your references here (APA / author–year).
