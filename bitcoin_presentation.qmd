---
title: "ðŸ“Š Bitcoin Hourly Data â€” Complete Storytelling"
subtitle: "Technical Analysis & Market Behavior Insights"
author: "Data Analytics & Storytelling"
date: today
format:
  revealjs:
    theme: default
    transition: slide
    background-transition: fade
    slide-number: true
    chalkboard: true
    preview-links: auto
    code-fold: false
    echo: true
    fig-width: 10
    fig-height: 5.5
    scrollable: true
execute:
  warning: false
  message: false
  cache: false
---

## Introduction {background-color="#1e3a5f"}

::: {.fragment}
**Bitcoin**: From obscure digital asset to global financial phenomenon
:::

::: {.fragment}
**Dataset**: `btc_hourly_ohclv_ta.csv` â€” Hourly OHLCV data with technical indicators
:::

::: {.fragment}
**Journey**: 7 Acts exploring price, volatility, volume, momentum, trends, and insights
:::

::: {.fragment}
**Objective**: Understand market behavior through data-driven storytelling
:::

---

## Setup & Data Loading {.smaller}

```{r setup}
# Install and load required packages
options(repos = c(CRAN = "https://cloud.r-project.org"))

pkgs <- c("tidyverse", "lubridate", "TTR", "zoo", "scales", "knitr", "patchwork")
missing <- setdiff(pkgs, rownames(installed.packages()))
if (length(missing) > 0) {
  message("Installing: ", paste(missing, collapse = ", "))
  install.packages(missing)
}

suppressPackageStartupMessages({
  library(tidyverse)
  library(lubridate)
  library(TTR)
  library(zoo)
  library(scales)
  library(knitr)
  library(patchwork)
})

# Set theme for consistent professional look
theme_set(theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12, color = "gray30"),
    axis.title = element_text(face = "bold")
  ))
```

---

## Data Loading {.smaller}

```{r load-data}
# Read the Bitcoin hourly dataset
csv_path <- "btc_hourly_ohclv_ta.csv"

# Check if file exists
if (!file.exists(csv_path)) {
  stop("âŒ File not found: ", csv_path, 
       "\nPlease ensure the CSV file is in the current directory.")
}

# Load data
df <- read_csv(csv_path, show_col_types = FALSE)

# Quick overview
cat("âœ… Dataset loaded successfully\n")
cat("ðŸ“Š Dimensions:", nrow(df), "rows Ã—", ncol(df), "columns\n")
cat("ðŸ“… Columns:", paste(head(names(df), 10), collapse = ", "), "...\n")
```

---

## Data Preprocessing {.smaller}

```{r preprocessing}
# Helper function: find column by name variants (case-insensitive)
find_col <- function(df, candidates) {
  cn_lower <- tolower(names(df))
  idx <- which(cn_lower %in% tolower(candidates))
  if (length(idx) == 0) return(NA_integer_)
  idx[1]
}

# Identify key columns
idx_time   <- find_col(df, c("datetime","date","timestamp","time","open_time"))
idx_open   <- find_col(df, c("open"))
idx_high   <- find_col(df, c("high"))
idx_low    <- find_col(df, c("low"))
idx_close  <- find_col(df, c("close","close_price"))
idx_volume <- find_col(df, c("volume","vol"))

# Create working dataset
dt <- as_tibble(df)

# Parse datetime
if (!is.na(idx_time)) {
  time_raw <- df[[idx_time]]
  if (!inherits(time_raw, "POSIXct")) {
    time_parsed <- suppressWarnings(ymd_hms(time_raw, tz = "UTC"))
    if (all(is.na(time_parsed))) {
      time_parsed <- suppressWarnings(ymd_hm(time_raw, tz = "UTC"))
    }
  } else {
    time_parsed <- time_raw
  }
  dt <- dt %>% mutate(datetime = time_parsed)
}

# Standardize OHLCV columns
if (!is.na(idx_open))   dt <- dt %>% mutate(open = as.numeric(df[[idx_open]]))
if (!is.na(idx_high))   dt <- dt %>% mutate(high = as.numeric(df[[idx_high]]))
if (!is.na(idx_low))    dt <- dt %>% mutate(low = as.numeric(df[[idx_low]]))
if (!is.na(idx_close))  dt <- dt %>% mutate(close = as.numeric(df[[idx_close]]))
if (!is.na(idx_volume)) dt <- dt %>% mutate(volume = as.numeric(df[[idx_volume]]))

# Sort by datetime
if ("datetime" %in% names(dt)) dt <- dt %>% arrange(datetime)

cat("âœ… Preprocessing complete\n")
```

---

## Feature Engineering {.smaller}

```{r feature-engineering}
# Calculate technical indicators
# Price changes (returns)
if ("close" %in% names(dt)) {
  dt <- dt %>% mutate(PRICE_CHANGE = close/lag(close) - 1)
}

# ATR (Average True Range) - volatility indicator
if (all(c("high","low","close") %in% names(dt))) {
  atr_result <- TTR::ATR(cbind(dt$high, dt$low, dt$close), n = 14)
  dt$ATR <- as.numeric(atr_result[,"atr"])
}

# RSI (Relative Strength Index) - momentum indicator
if ("close" %in% names(dt)) {
  dt$RSI <- as.numeric(TTR::RSI(dt$close, n = 14))
}

# Moving averages
if ("close" %in% names(dt)) {
  dt$SMA_20 <- as.numeric(TTR::SMA(dt$close, n = 20))
  dt$EMA_12 <- as.numeric(TTR::EMA(dt$close, n = 12))
  dt$EMA_26 <- as.numeric(TTR::EMA(dt$close, n = 26))
}

# MACD (Moving Average Convergence Divergence)
if ("close" %in% names(dt)) {
  macd <- TTR::MACD(dt$close, nFast = 12, nSlow = 26, nSig = 9)
  dt$MACD <- as.numeric(macd[,"macd"])
  dt$MACD_SIGNAL <- as.numeric(macd[,"signal"])
}

# 30-day rolling volatility (standard deviation of returns)
if ("PRICE_CHANGE" %in% names(dt)) {
  dt$VOLATILITY_30D <- as.numeric(
    zoo::rollapply(dt$PRICE_CHANGE, width = 720, FUN = sd, 
                   align = "right", fill = NA, na.rm = TRUE)
  )
}

# Volume moving average
if ("volume" %in% names(dt)) {
  dt$VOLUME_SMA <- as.numeric(TTR::SMA(dt$volume, n = 20))
}

# Price ratios
if (all(c("high","low","close") %in% names(dt))) {
  dt$HIGH_LOW_RATIO <- (dt$high - dt$low) / dt$close
}
if (all(c("close","open") %in% names(dt))) {
  dt$CLOSE_OPEN_RATIO <- dt$close / dt$open - 1
}

cat("âœ… Feature engineering complete\n")
cat("ðŸ“ˆ Available indicators:", 
    paste(intersect(names(dt), 
                    c("PRICE_CHANGE","ATR","RSI","SMA_20","MACD","VOLATILITY_30D")),
          collapse = ", "), "\n")
```

---

# Act 1 {background-color="#1e3a5f"}
## The Context: "A Decade of Bitcoin"

::: {.fragment}
Bitcoin has evolved from a marginal asset to a highly volatile and liquid market
:::

---

## Act 1: Global Statistics {.smaller}

```{r act1-stats}
# Verify required columns exist
stopifnot(all(c("datetime","close") %in% names(dt)))

# Calculate key metrics
date_range <- range(dt$datetime, na.rm = TRUE)
n_hours <- sum(!is.na(dt$datetime))
price_min <- min(dt$close, na.rm = TRUE)
price_median <- median(dt$close, na.rm = TRUE)
price_max <- max(dt$close, na.rm = TRUE)
vol_total <- if ("volume" %in% names(dt)) sum(dt$volume, na.rm = TRUE) else NA_real_

# Create summary table
summary_table <- tibble(
  Metric = c("Period Start", "Period End", "Total Hours", 
             "Min Price", "Median Price", "Max Price", "Total Volume"),
  Value = c(
    format(date_range[1], "%Y-%m-%d"),
    format(date_range[2], "%Y-%m-%d"),
    prettyNum(n_hours, big.mark = ","),
    paste0("$", prettyNum(round(price_min, 2), big.mark = ",")),
    paste0("$", prettyNum(round(price_median, 2), big.mark = ",")),
    paste0("$", prettyNum(round(price_max, 2), big.mark = ",")),
    if (!is.na(vol_total)) prettyNum(round(vol_total, 0), big.mark = ",") else "N/A"
  )
)

kable(summary_table, align = c("l","r"))
```

::: {.fragment}
**Insight**: Bitcoin's price has experienced massive growth from `r paste0("$",prettyNum(round(price_min,2),big.mark=","))` to `r paste0("$",prettyNum(round(price_max,2),big.mark=","))` â€” a journey of extreme volatility.
:::

---

## Act 1: Price Over Time {.smaller}

```{r act1-price-line, fig.height=5}
# Bitcoin price over the entire period
ggplot(dt, aes(x = datetime, y = close)) +
  geom_line(color = "#2C7FB8", linewidth = 0.4) +
  scale_y_continuous(labels = scales::comma_format(prefix = "$")) +
  labs(
    title = "Bitcoin Hourly Price (CLOSE)",
    subtitle = "Complete historical view showing explosive growth phases",
    x = "Date",
    y = "Price (USD)"
  ) +
  theme_minimal(base_size = 14)
```

::: {.fragment}
**Observation**: Growth is non-linear with distinct explosion and stagnation phases.
:::

---

## Act 1: Price Distribution {.smaller}

```{r act1-price-hist, fig.height=5}
# Histogram of Bitcoin prices
ggplot(dt, aes(x = close)) +
  geom_histogram(bins = 60, fill = "#7FCDBB", color = "grey30", alpha = 0.8) +
  scale_x_continuous(labels = scales::comma_format(prefix = "$")) +
  labs(
    title = "Distribution of Bitcoin Prices",
    subtitle = "Most trading occurs at lower price levels",
    x = "Price (USD)",
    y = "Frequency"
  ) +
  theme_minimal(base_size = 14)
```

::: {.fragment}
**Conclusion Act 1**: Bitcoin's trajectory is characterized by rapid bull runs followed by prolonged consolidation.
:::

---

# Act 2 {background-color="#8b0000"}
## Volatility: Bitcoin's DNA

::: {.fragment}
Volatility is constant, but its intensity varies across different periods
:::

---

## Act 2: Volatility Statistics {.smaller}

```{r act2-stats}
# Calculate volatility metrics
vol_metrics <- list()

if ("ATR" %in% names(dt)) {
  vol_metrics$ATR_mean <- mean(dt$ATR, na.rm = TRUE)
  vol_metrics$ATR_max <- max(dt$ATR, na.rm = TRUE)
}

if ("VOLATILITY_30D" %in% names(dt)) {
  vol_metrics$VOL30D_mean <- mean(dt$VOLATILITY_30D, na.rm = TRUE)
  vol_metrics$VOL30D_max <- max(dt$VOLATILITY_30D, na.rm = TRUE)
  
  # Compare early vs recent years
  if ("datetime" %in% names(dt)) {
    dt_vol <- dt %>% filter(!is.na(VOLATILITY_30D), !is.na(datetime))
    mid_date <- median(dt_vol$datetime, na.rm = TRUE)
    vol_metrics$VOL_early <- mean(dt_vol %>% 
                                    filter(datetime < mid_date) %>% 
                                    pull(VOLATILITY_30D), na.rm = TRUE)
    vol_metrics$VOL_recent <- mean(dt_vol %>% 
                                     filter(datetime >= mid_date) %>% 
                                     pull(VOLATILITY_30D), na.rm = TRUE)
  }
}

# Display as table
as_tibble(vol_metrics) %>%
  pivot_longer(everything(), names_to = "Metric", values_to = "Value") %>%
  mutate(Value = signif(Value, 4)) %>%
  kable(align = c("l","r"))
```

::: {.fragment}
**Key Finding**: Volatility shows a `r if(exists("vol_metrics") && "VOL_early" %in% names(vol_metrics)) ifelse(vol_metrics$VOL_recent < vol_metrics$VOL_early, "decreasing", "increasing") else "varying"` trend, indicating market maturation.
:::

---

## Act 2: Volatility Time Series {.smaller}

```{r act2-vol-line, fig.height=5}
# 30-day rolling volatility over time
if ("VOLATILITY_30D" %in% names(dt) && "datetime" %in% names(dt)) {
  dt_vol <- dt %>% filter(!is.na(VOLATILITY_30D), !is.na(datetime))
  
  ggplot(dt_vol, aes(x = datetime, y = VOLATILITY_30D)) +
    geom_line(color = "#E31A1C", linewidth = 0.5, alpha = 0.8) +
    labs(
      title = "30-Day Rolling Volatility",
      subtitle = "Standard deviation of hourly returns (720-hour window)",
      x = "Date",
      y = "Volatility (Ïƒ)"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Observation**: Volatility spikes coincide with major market events and sentiment shifts.
:::

---

## Act 2: Volatility by Year {.smaller}

```{r act2-vol-boxplot, fig.height=5}
# Boxplot of volatility distribution by year
if ("VOLATILITY_30D" %in% names(dt) && "datetime" %in% names(dt)) {
  dt_vol <- dt %>% 
    filter(!is.na(VOLATILITY_30D), !is.na(datetime)) %>%
    mutate(year = year(datetime))
  
  ggplot(dt_vol, aes(x = factor(year), y = VOLATILITY_30D)) +
    geom_boxplot(fill = "#FF7F00", alpha = 0.7, outlier.alpha = 0.3) +
    labs(
      title = "Volatility Distribution by Year",
      subtitle = "Each box shows 25th-75th percentile range",
      x = "Year",
      y = "Volatility (Ïƒ)"
    ) +
    theme_minimal(base_size = 14) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
```

::: {.fragment}
**Conclusion Act 2**: The market is maturing slowly, but instability remains â€” creating both opportunity and risk.
:::

---

# Act 3 {background-color="#006400"}
## Volume: When the Market Goes Wild

::: {.fragment}
Volume tells the story of crises and bull runs
:::

---

## Act 3: Volume Statistics {.smaller}

```{r act3-stats}
# Calculate volume metrics
if ("volume" %in% names(dt)) {
  vol_mean <- mean(dt$volume, na.rm = TRUE)
  vol_median <- median(dt$volume, na.rm = TRUE)
  vol_q99 <- quantile(dt$volume, 0.99, na.rm = TRUE)
  
  vol_stats <- tibble(
    Metric = c("Average Volume", "Median Volume", "Top 1% Threshold (99th percentile)"),
    Value = c(
      prettyNum(round(vol_mean, 0), big.mark = ","),
      prettyNum(round(vol_median, 0), big.mark = ","),
      prettyNum(round(vol_q99, 0), big.mark = ",")
    )
  )
  
  # Correlation between volume and price movement
  if ("PRICE_CHANGE" %in% names(dt)) {
    dt_clean <- dt %>% filter(!is.na(volume), !is.na(PRICE_CHANGE))
    if (nrow(dt_clean) > 2) {
      corr <- cor(dt_clean$volume, abs(dt_clean$PRICE_CHANGE), use = "complete.obs")
      vol_stats <- vol_stats %>% add_row(
        Metric = "Correlation: Volume â†” |Price Change|",
        Value = as.character(round(corr, 3))
      )
    }
  }
  
  kable(vol_stats, align = c("l","r"))
}
```

::: {.fragment}
**Key Finding**: High correlation between volume and price volatility confirms that large moves require significant trading activity.
:::

---

## Act 3: Volume Over Time {.smaller}

```{r act3-vol-line, fig.height=5}
# Volume time series
if ("volume" %in% names(dt) && "datetime" %in% names(dt)) {
  dt_vol <- dt %>% filter(!is.na(volume), !is.na(datetime))
  
  ggplot(dt_vol, aes(x = datetime, y = volume)) +
    geom_line(color = "#1F78B4", linewidth = 0.4, alpha = 0.7) +
    scale_y_continuous(labels = scales::comma_format()) +
    labs(
      title = "Trading Volume Over Time",
      subtitle = "Hourly volume showing market participation intensity",
      x = "Date",
      y = "Volume"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Observation**: Volume spikes mark critical market turning points and high-volatility events.
:::

---

## Act 3: Volume vs Price Movement {.smaller}

```{r act3-scatter, fig.height=5}
# Scatter: Volume vs absolute price change
if (all(c("volume","PRICE_CHANGE","datetime") %in% names(dt))) {
  dt_scatter <- dt %>% 
    filter(!is.na(volume), !is.na(PRICE_CHANGE)) %>%
    mutate(abs_change = abs(PRICE_CHANGE)) %>%
    sample_n(min(10000, n()))  # Sample for performance
  
  ggplot(dt_scatter, aes(x = volume, y = abs_change)) +
    geom_point(alpha = 0.15, color = "#A6CEE3", size = 1.5) +
    geom_smooth(method = "lm", color = "#E31A1C", se = TRUE) +
    scale_x_continuous(labels = scales::comma_format()) +
    scale_y_continuous(labels = scales::percent_format()) +
    labs(
      title = "Volume vs Absolute Price Change",
      subtitle = "Large price moves typically require high volume",
      x = "Volume",
      y = "|Price Change| (%)"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Conclusion Act 3**: Almost all major price movements are accompanied by abnormal volume levels.
:::

---

# Act 4 {background-color="#4b0082"}
## Momentum & Market Psychology

::: {.fragment}
Technical indicators translate market emotions into quantifiable signals
:::

---

## Act 4: RSI Statistics {.smaller}

```{r act4-stats}
# Calculate RSI metrics
if ("RSI" %in% names(dt)) {
  rsi_mean <- mean(dt$RSI, na.rm = TRUE)
  rsi_over70 <- mean(dt$RSI > 70, na.rm = TRUE) * 100
  rsi_under30 <- mean(dt$RSI < 30, na.rm = TRUE) * 100
  
  rsi_stats <- tibble(
    Metric = c("Average RSI", "% Time RSI > 70 (Overbought)", "% Time RSI < 30 (Oversold)"),
    Value = c(
      as.character(round(rsi_mean, 2)),
      paste0(round(rsi_over70, 2), "%"),
      paste0(round(rsi_under30, 2), "%")
    )
  )
  
  kable(rsi_stats, align = c("l","r"))
}
```

::: {.fragment}
**Key Finding**: The market spends `r if("RSI" %in% names(dt)) paste0(round(mean(dt$RSI > 70 | dt$RSI < 30, na.rm=TRUE)*100,1),"%") else "a significant portion"` of time in extreme zones â€” more than most traders expect.
:::

---

## Act 4: RSI Over Time {.smaller}

```{r act4-rsi-line, fig.height=5}
# RSI time series with thresholds
if ("RSI" %in% names(dt) && "datetime" %in% names(dt)) {
  dt_rsi <- dt %>% filter(!is.na(RSI), !is.na(datetime))
  
  ggplot(dt_rsi, aes(x = datetime, y = RSI)) +
    geom_line(color = "#33A02C", linewidth = 0.4, alpha = 0.8) +
    geom_hline(yintercept = 70, color = "#E31A1C", linetype = "dashed", linewidth = 0.8) +
    geom_hline(yintercept = 30, color = "#1F78B4", linetype = "dashed", linewidth = 0.8) +
    annotate("text", x = max(dt_rsi$datetime, na.rm = TRUE), y = 72, 
             label = "Overbought (70)", hjust = 1, color = "#E31A1C", size = 3.5) +
    annotate("text", x = max(dt_rsi$datetime, na.rm = TRUE), y = 28, 
             label = "Oversold (30)", hjust = 1, color = "#1F78B4", size = 3.5) +
    labs(
      title = "RSI (Relative Strength Index)",
      subtitle = "Momentum indicator with overbought/oversold thresholds",
      x = "Date",
      y = "RSI"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Observation**: Extreme RSI values often precede trend reversals or consolidation periods.
:::

---

## Act 4: RSI Distribution {.smaller}

```{r act4-rsi-hist, fig.height=5}
# Histogram of RSI values
if ("RSI" %in% names(dt)) {
  dt_rsi <- dt %>% filter(!is.na(RSI))
  
  ggplot(dt_rsi, aes(x = RSI)) +
    geom_histogram(bins = 50, fill = "#B2DF8A", color = "grey30", alpha = 0.8) +
    geom_vline(xintercept = 70, color = "#E31A1C", linetype = "dashed", linewidth = 0.8) +
    geom_vline(xintercept = 30, color = "#1F78B4", linetype = "dashed", linewidth = 0.8) +
    labs(
      title = "RSI Distribution",
      subtitle = "Frequency of momentum states",
      x = "RSI",
      y = "Frequency"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Conclusion Act 4**: Market psychology drives price through identifiable momentum patterns.
:::

---

# Act 5 {background-color="#ff8c00"}
## Trends & Market Regimes

::: {.fragment}
Bitcoin alternates between trending and ranging behavior
:::

---

## Act 5: Trend Statistics {.smaller}

```{r act5-stats}
# Calculate trend regime metrics
trend_stats <- list()

if (all(c("close","SMA_20") %in% names(dt))) {
  dt_sma <- dt %>% filter(!is.na(close), !is.na(SMA_20))
  pct_above_sma <- mean(dt_sma$close > dt_sma$SMA_20) * 100
  trend_stats$pct_above_sma20 <- paste0(round(pct_above_sma, 1), "%")
}

if (all(c("EMA_12","EMA_26") %in% names(dt))) {
  dt_ema <- dt %>% filter(!is.na(EMA_12), !is.na(EMA_26))
  pct_bullish <- mean(dt_ema$EMA_12 > dt_ema$EMA_26) * 100
  trend_stats$pct_ema_bullish <- paste0(round(pct_bullish, 1), "%")
}

if (length(trend_stats) > 0) {
  tibble(
    Metric = c("% Time Price > SMA(20)", "% Time EMA(12) > EMA(26) [Bullish]"),
    Value = unlist(trend_stats)
  ) %>% kable(align = c("l","r"))
}
```

::: {.fragment}
**Key Finding**: Market spends roughly half the time in bullish vs bearish regimes, with frequent regime changes.
:::

---

## Act 5: Price with Moving Averages {.smaller}

```{r act5-ma-plot, fig.height=5}
# Price with SMA overlay
if (all(c("close","SMA_20","datetime") %in% names(dt))) {
  dt_ma <- dt %>% filter(!is.na(close), !is.na(SMA_20), !is.na(datetime))
  
  ggplot(dt_ma, aes(x = datetime)) +
    geom_line(aes(y = close), color = "#2C7FB8", linewidth = 0.4, alpha = 0.7) +
    geom_line(aes(y = SMA_20), color = "#E31A1C", linewidth = 0.7) +
    scale_y_continuous(labels = scales::comma_format(prefix = "$")) +
    labs(
      title = "Price with 20-Period Simple Moving Average",
      subtitle = "Blue: Price | Red: SMA(20) trend line",
      x = "Date",
      y = "Price (USD)"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Observation**: SMA acts as dynamic support/resistance, with price crossing frequently.
:::

---

## Act 5: MACD Indicator {.smaller}

```{r act5-macd-plot, fig.height=5}
# MACD and signal line
if (all(c("MACD","MACD_SIGNAL","datetime") %in% names(dt))) {
  dt_macd <- dt %>% filter(!is.na(MACD), !is.na(MACD_SIGNAL), !is.na(datetime))
  
  ggplot(dt_macd, aes(x = datetime)) +
    geom_line(aes(y = MACD), color = "#1F78B4", linewidth = 0.5, alpha = 0.8) +
    geom_line(aes(y = MACD_SIGNAL), color = "#E31A1C", linewidth = 0.5, alpha = 0.8) +
    geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 0.6) +
    labs(
      title = "MACD (Moving Average Convergence Divergence)",
      subtitle = "Blue: MACD | Red: Signal Line | Crossovers indicate momentum shifts",
      x = "Date",
      y = "MACD Value"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Conclusion Act 5**: Trends exist but are often short-lived and violent â€” timing is critical.
:::

---

# Act 6 {background-color="#8b4513"}
## Ratios & Micro-Movements

::: {.fragment}
At the hourly scale, the market is extremely noisy
:::

---

## Act 6: Ratio Statistics {.smaller}

```{r act6-stats}
# Calculate ratio and micro-movement metrics
ratio_stats <- list()

if ("HIGH_LOW_RATIO" %in% names(dt)) {
  ratio_stats$HLR_mean <- round(mean(dt$HIGH_LOW_RATIO, na.rm = TRUE), 4)
}
if ("CLOSE_OPEN_RATIO" %in% names(dt)) {
  ratio_stats$COR_mean <- round(mean(dt$CLOSE_OPEN_RATIO, na.rm = TRUE), 4)
}
if ("PRICE_CHANGE" %in% names(dt)) {
  ratio_stats$PC_mean <- round(mean(dt$PRICE_CHANGE, na.rm = TRUE), 4)
  ratio_stats$PC_std <- round(sd(dt$PRICE_CHANGE, na.rm = TRUE), 4)
}

if (length(ratio_stats) > 0) {
  tibble(
    Metric = c("Avg High-Low Ratio", "Avg Close-Open Ratio", 
               "Avg Price Change", "Std Dev Price Change"),
    Value = unlist(ratio_stats)
  ) %>% kable(align = c("l","r"))
}
```

::: {.fragment}
**Key Finding**: High noise-to-signal ratio at hourly frequency emphasizes the importance of filtering and risk management.
:::

---

## Act 6: Price Change Distribution {.smaller}

```{r act6-price-change-hist, fig.height=5}
# Histogram of hourly price changes (zoomed Â±20%)
if ("PRICE_CHANGE" %in% names(dt)) {
  dt_pc <- dt %>% 
    filter(!is.na(PRICE_CHANGE), abs(PRICE_CHANGE) < 0.2)
  
  ggplot(dt_pc, aes(x = PRICE_CHANGE)) +
    geom_histogram(bins = 80, fill = "#FDBF6F", color = "grey30", alpha = 0.8) +
    scale_x_continuous(labels = scales::percent_format()) +
    labs(
      title = "Distribution of Hourly Price Changes",
      subtitle = "Zoomed to Â±20% for clarity (removes extreme outliers)",
      x = "Price Change (%)",
      y = "Frequency"
    ) +
    theme_minimal(base_size = 14)
}
```

::: {.fragment}
**Observation**: Distribution shows fat tails â€” extreme moves occur more often than normal distribution predicts.
:::

---

## Act 6: Correlation Heatmap {.smaller}

```{r act6-corr-heatmap, fig.height=5.5}
# Correlation heatmap of key features
key_features <- intersect(names(dt), 
                          c("close","volume","ATR","RSI","VOLATILITY_30D",
                            "PRICE_CHANGE","HIGH_LOW_RATIO","CLOSE_OPEN_RATIO"))

if (length(key_features) >= 2) {
  dt_cor <- dt %>% select(all_of(key_features)) %>% na.omit()
  
  if (nrow(dt_cor) > 10) {
    cor_matrix <- cor(dt_cor, use = "complete.obs")
    cor_tidy <- as.data.frame(as.table(cor_matrix))
    names(cor_tidy) <- c("Var1", "Var2", "Correlation")
    
    ggplot(cor_tidy, aes(x = Var1, y = Var2, fill = Correlation)) +
      geom_tile(color = "white") +
      scale_fill_gradient2(low = "#0571B0", mid = "white", high = "#CA0020", 
                           midpoint = 0, limits = c(-1,1)) +
      labs(
        title = "Feature Correlation Heatmap",
        subtitle = "Relationships between key technical indicators",
        x = NULL, y = NULL
      ) +
      theme_minimal(base_size = 12) +
      theme(axis.text.x = element_text(angle = 45, hjust = 1))
  }
}
```

::: {.fragment}
**Conclusion Act 6**: Noise dominates hourly data â€” ML and sophisticated risk management are essential.
:::

---

# Act 7 {background-color="#1e3a5f"}
## Final Summary

::: {.fragment}
Bitcoin: A highly non-stationary, emotional, and volatile market â€” but rich in exploitable signals
:::

---

## Summary Table {.smaller}

```{r act7-summary-table}
# Create comprehensive summary table
summary_df <- data.frame(
  Dimension = c("ðŸ“Š Price", "ðŸ“ˆ Volatility", "ðŸ’¹ Volume", "ðŸŽ¯ Momentum", "ðŸ“‰ Trends", "ðŸ”¢ Ratios"),
  Key_Indicator = c("CLOSE", "VOLATILITY_30D", "VOLUME", "RSI", "MACD", "PRICE_CHANGE"),
  Observation = c(
    "Non-linear growth with explosion and stagnation phases",
    "Fluctuating but persistent; market slowly maturing",
    "Highly correlated with major price moves; crisis/bull run indicator",
    "Market spends significant time in extreme zones (overbought/oversold)",
    "Short-lived and violent; frequent regime changes",
    "High noise at hourly frequency; requires sophisticated filtering"
  ),
  Recommendation = c(
    "Identify accumulation zones in consolidation periods",
    "Use volatility filters to avoid whipsaws",
    "Monitor volume spikes for confirmation of breakouts",
    "Fade extremes; wait for mean reversion signals",
    "Combine multiple timeframes; don't fight the trend",
    "Apply ML models with proper feature engineering and risk controls"
  )
)

kable(summary_df, 
      col.names = c("Dimension", "Key Indicator", "Observation", "Recommendation"),
      align = c("l","l","l","l"))
```

---

## Key Conclusions {.smaller}

::: {.incremental}
1. **Price Behavior**: Bitcoin has experienced ~`r if(all(c("close","datetime") %in% names(dt))) paste0(round((max(dt$close,na.rm=TRUE)/min(dt$close,na.rm=TRUE)-1)*100,0),"% growth") else "massive growth"` with extreme volatility â€” creating both wealth and risk

2. **Volatility Dynamics**: Persistent but evolving â€” recent years show `r if("VOLATILITY_30D" %in% names(dt) && "datetime" %in% names(dt)) {dt_v <- dt %>% filter(!is.na(VOLATILITY_30D),!is.na(datetime)); mid <- median(dt_v$datetime); early <- mean(dt_v %>% filter(datetime<mid) %>% pull(VOLATILITY_30D),na.rm=TRUE); recent <- mean(dt_v %>% filter(datetime>=mid) %>% pull(VOLATILITY_30D),na.rm=TRUE); ifelse(recent<early,"declining","increasing")} else "evolving"` volatility as market matures

3. **Volume Insights**: Strong correlation (`r if(all(c("volume","PRICE_CHANGE") %in% names(dt))) {round(cor(dt$volume, abs(dt$PRICE_CHANGE), use="complete.obs"),2)} else "~0.3+"`) between volume and price movement validates volume as a key confirmation indicator

4. **Momentum Patterns**: RSI extremes (`r if("RSI" %in% names(dt)) paste0(round(mean(dt$RSI>70|dt$RSI<30,na.rm=TRUE)*100,1),"%") else "~20%"` of time) signal overbought/oversold conditions more frequently than expected

5. **Trend Behavior**: Market regimes change rapidly â€” trends are powerful but short-lived, requiring adaptive strategies

6. **Noise & Signal**: Hourly data is extremely noisy â€” advanced filtering, multi-timeframe analysis, and rigorous risk management are non-negotiable
:::

---

## Actionable Insights for Trading {.smaller}

::: {.incremental}
**For Short-Term Traders (Hourly/Daily)**:
- Use volume confirmation for all breakout trades
- Fade RSI extremes with tight stops
- Watch for MACD crossovers but confirm with price action

**For Swing Traders (Days/Weeks)**:
- Identify volatility compression periods (low VOLATILITY_30D) as setup zones
- Trade in direction of SMA_20 and EMA alignment
- Scale positions during high volume spikes

**For Long-Term Investors (Months/Years)**:
- Accumulate during prolonged consolidation phases (low volatility)
- Use RSI < 30 as accumulation signal in downtrends
- DCA (Dollar-Cost Average) to smooth entry timing
:::

---

## Next Steps & Advanced Analysis {.smaller}

::: {.incremental}
**Machine Learning Applications**:
- Feature engineering: lagged returns, volatility regimes, volume profiles
- Model types: Random Forest, XGBoost, LSTM for time series
- Cross-validation: time-series split to prevent look-ahead bias

**Backtesting Framework**:
- Define entry/exit rules based on indicators
- Simulate transaction costs and slippage
- Calculate Sharpe ratio, max drawdown, win rate

**Risk Management**:
- Position sizing based on volatility (ATR-based stops)
- Portfolio heat limits (max % of capital at risk)
- Correlation analysis across crypto assets

**Further Reading**:
- "Advances in Financial Machine Learning" by Marcos LÃ³pez de Prado
- "Algorithmic Trading" by Ernie Chan
- Online: Quantopian, QuantConnect, backtrader documentation
:::

---

## Technical Stack Used {.smaller background-color="#2d2d2d" style="color: white;"}

```{r tech-stack, echo=TRUE, eval=FALSE}
# Core packages for this analysis
library(tidyverse)   # Data manipulation & visualization
library(lubridate)   # Date/time parsing and manipulation
library(TTR)         # Technical trading indicators (RSI, MACD, ATR, etc.)
library(zoo)         # Rolling window calculations
library(scales)      # Axis formatting (commas, percentages, etc.)
library(knitr)       # Table formatting
library(patchwork)   # Plot composition and arrangement

# Recommended additional packages for production
# library(quantmod)     # Financial data retrieval
# library(PerformanceAnalytics)  # Performance and risk metrics
# library(forecast)     # Time series forecasting
# library(caret)        # Machine learning framework
# library(xgboost)      # Gradient boosting for predictions
```

::: {style="color: #7fb3d5; margin-top: 20px;"}
**Presentation powered by**: Quarto + revealjs + R
:::

---

## Thank You {background-color="#1e3a5f"}

::: {style="text-align: center; margin-top: 100px;"}
## Questions?

**Contact**: nadhir.benhalima.software@gmail.com  
**Repository**: https://github.com/Nadhir1210/btc-_hourly  
**Rendered**: `r Sys.Date()`

::: {.fragment}
*"In God we trust. All others must bring data."* â€” W. Edwards Deming
:::
:::

---

## Appendix: Rendering Instructions {.smaller background-color="#f5f5f5"}

**To render this presentation**:

```bash
# Basic HTML (revealjs) output
quarto render bitcoin_presentation.qmd

# Open in browser immediately
quarto render bitcoin_presentation.qmd && open bitcoin_presentation.html

# Watch mode for live preview during editing
quarto preview bitcoin_presentation.qmd
```

**Custom theme** (create `custom.scss` in same directory):

```scss
/*-- scss:defaults --*/
$body-bg: #ffffff;
$body-color: #2d2d2d;
$link-color: #2C7FB8;
$presentation-heading-color: #1e3a5f;

/*-- scss:rules --*/
.reveal h1 { font-size: 2.2em; }
.reveal h2 { font-size: 1.6em; }
```

**Requirements**:
- R 4.0+ with packages: tidyverse, TTR, zoo, lubridate
- Quarto 1.3+
- Dataset: `btc_hourly_ohclv_ta.csv` in working directory
